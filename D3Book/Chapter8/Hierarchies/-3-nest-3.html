<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hierarchies</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
<script>
    // Building a hierarchy without using stratify().

    // Using recursive function to convert table to hierarchy
    d3.csv("../Data/un_regions.csv").then(function(result) {
        console.log("tabular data", result);

        // group: supercontinent/continent/un-region/country
        const nested = d3.nest()
                        .key(d => d.Supercontinent)
                        .key(d => d.Continent)
                        .key(d => d.UN_Region)
                        .key(d => d.Country)
                        .rollup(d => d.map(c => ({area: +c.Area_km2, population: +c.Pop_2016, hdi: +c.HDI_2017})))
                        .entries(result);

        console.log("nested data", nested);

        // convert to simple D3 hierarchy (data/children/depth/length)
        const h1 = makeD3Hierarchy(nested);
        console.log("hierarchical data", h1);

    });

    function makeD3Hierarchy(items) {
        const object = {
            key: 'World',
            values: items
        };
        return d3.hierarchy(object, d => d.values);
    }

</script>

<h1>See console for results</h1>
</body>
</html>