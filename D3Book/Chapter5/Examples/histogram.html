<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        text {
            font-family: 'Yanone Kaffeesatz', sans-serif;
            font-size: 10pt;
        }
        .label {
            font-size: 8pt;
        }
        svg {
            border: solid 1px gray;
        }
    </style>
</head>
<body>
<svg width="100%" height="100%" viewBox="0 0 500 300"/>
<script>
    const w = 500, h = 300, marginH = 50, marginW = 25;
    const scaleX = d3.scaleLinear().range([marginW,w-marginW]);
    const scaleY = d3.scaleLinear().range([marginH,h-marginH]);
    const color  = d3.scaleLinear().range([0,1]);

    let bins, barWidth;
    let total;

    const format = d3.format(".1%")

    d3.json("../Data/common-letters.json")
        .then(function(data) {
            total = +data.sample;
            bins = data.frequencies.sort(function(a,b) {
                return d3.ascending(a.letter, b.letter);
            });
            barWidth = (w - marginW*2)/bins.length;
            scaleY.domain([1,d3.max(bins, function(d) {
                return d.frequency;
            })]);
            scaleX.domain([0,bins.length]);
            color.domain([1,d3.max(bins, function(d) {
                return d.frequency;
            })]);
            draw();
        });

    function draw() {
        d3.select("svg").selectAll(".bar")
                .data(bins)
                .enter()
                .append("g")
                .attr("transform", function(d,i) {
                    return "translate("+[scaleX(i), (h-marginH/3) - scaleY(d.frequency)]+")";
                }).each(function(d,i) {
                    d3.select(this).append("rect")
                        .attr("height", function() {
                            return scaleY(d.frequency);
                        }).attr("width", barWidth-2)
                        .style("fill", function() {
                            return d3.interpolateSinebow(color(d.frequency));
                        });
                    d3.select(this).append("text")
                            .text(function() {
                                return d.letter;
                            }).attr("x", function() {
                                return barWidth/3;
                            }).attr("y", function(d,i) {
                                return scaleY(d.frequency) +12;
                            });

                    d3.select(this).append("text").attr("class","label")
                            .text(function() {
                                return format(d.frequency / total);
                            }).attr("transform", function() {
                                return "rotate(-90,"+barWidth/4+","+-barWidth/3+")";
                            });
                });

    }




</script>
</body>
</html>