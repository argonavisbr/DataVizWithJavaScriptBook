<!DOCTYPE html>
<html lang="en">
<head>
    <title>Zoom and Rotating (Reprojecting)</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>

<style>
    body {
        margin: 0;
    }

    svg {
        background-color: #333;
    }

    .sphere {
        fill: #A7DBD8;
        stroke: #79A09E;
    }

    .land {
        fill: #E0E4CC;
        stroke: #ACAF9F;
        stroke-width: 1;
    }

    .graticule {
        fill: none;
        stroke: #79A09E;
        stroke-width: 1;
        stroke-dasharray: 1,2;
    }

    .overlay {
        fill-opacity: 0;
    }
</style>

<script>

    const width = 960;
    const height = 500;

    const z = {
        transform: d3.zoomIdentity.scale(height/2)
    }

    const projection = d3.geoOrthographic();
    const geoPath    = d3.geoPath().projection(projection);
    const graticule  = d3.geoGraticule();

    const zoomMap = d3.zoom()
            .on('zoom', function() {
                const zoom = d3.event;

                console.log(zoom.transform, z)

                z.transform.k = z.transform.k * zoom.transform.k;
                z.transform.x = z.transform.x + zoom.transform.x;

                projection.scale(z.transform.k)
                          .rotate([z.transform.x, 0, 0]);

                svg.selectAll('path').attr('d', geoPath);
            });

    const svg = d3.select("body").append("svg")
            .attr("width", width).attr("height", height)
            .call(zoomMap);

    d3.json('../Data/world-lowres.geojson')
            .then(function(data) {

        svg.append('path')
                .datum({type: 'Sphere'})
                .classed('sphere', true)
                .attr('d', geoPath);

        svg.append('path')
                .datum(graticule())
                .classed('graticule', true)
                .attr('d', geoPath);

        svg.selectAll('path.land')
                .data(data.features)
                .enter()
                .append('path')
                .classed('land', true)
                .attr('d', geoPath);

    });
</script>

</body>
</html>