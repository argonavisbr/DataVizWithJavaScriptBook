<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/d3-tile"></script>
</head>
<body>
<script>

    const width = 960;
    const height = 500;

    const tileSize = 256;

    const svg = d3.select("body").append("svg")
            .attr("width", width).attr("height", height);

    const tile = d3.tile().extent([[0,0],[width, height]]);

    const z = 2; // change to zoom
    const scale0 = 1 << z; // Same as Math.pow(2,z);
    const trans0 = scale0/2;

    const zoom = d3.zoom()
            //.scale(scale0 * tileSize)
            //.translate([trans0 * tileSize, trans0 * tileSize])
            .on('zoom', zoomed);

    const tileCanvas = svg.append("g")
            .attr("class", "tiles")
            .call(zoom);

    drawTiles();

    function zoomed() {
        drawTiles();
    }


    function drawTiles() {
        console.log(d3.zoomTransform(this))
        console.log(d3.event && d3.event.transform ? d3.event.transform : '')

        const t = d3.event && d3.event.transform ? d3.event.transform : d3.zoomTransform(this)

        tile.scale(t.k).translate([t.x,t.y])

        const tiles = tile();

        console.log(tiles)

        const tileCanvas = d3.select(".tiles");

        tileCanvas.selectAll("image")
            .data(tiles)
            .enter()
            .append("image")
            .attr("xlink:href", tileUrl)
            .attr("width", tileSize)
            .attr("height", tileSize)
            .attr("x", d => d.tx)
            .attr("y", d => d.ty);
    }

    function tileUrl(d) {
        const subdomain = ["a","b","c"][Math.random() * 3 | 0];
        const url = `http://${subdomain}.tile.openstreetmap.org/${d.z}/${d.x}/${d.y}.png`;
        console.log(url)
        return url;
    }

    function matrix3d(scale, translate) {
        var k = scale / tileSize, r = scale % 1 ? Number : Math.round;
        return "matrix3d(" + [k, 0, 0, 0, 0, k, 0, 0, 0, 0, k, 0, r(translate[0] * scale), r(translate[1] * scale), 0, 1 ] + ")";
    }

</script>
</body>
</html>