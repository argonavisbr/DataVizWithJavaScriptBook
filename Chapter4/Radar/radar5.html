<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js">
    </script>

</head>
<body>
<!-- https://datahub.io/core/global-temp -->
<!-- NASA GISS - radar -->
<canvas id="my-radar-chart" width="400" height="200"></canvas>

<script>
    fetch('monthly_json.json')
        .then(response => response.text())
        .then((json) => {
            draw(parseCoords(json));
        });

    function parseCoords(json) {
        let perYear = new Map();
        JSON.parse(json)
            .reverse()
            .filter(field => field.Source == 'GISTEMP')
            .forEach(d => {
                let year = d.Date.split("-")[0];
                let month = d.Date.split("-")[1];
                if(perYear.get(year)) {
                    perYear.get(year).push({year: year, month: month, value: d.Mean});
                } else {
                    perYear.set(year, [{year: year, month: month, value: d.Mean}]);
                }
        });
        return perYear;
    }

    let months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

    function draw(datasetMap) {
        let datasets = [];
        let labels = [];
        datasetMap.forEach((entry, key) => {
            let dataset = {
                label: key,
                data: entry.map(n => n.value),
                borderColor: 'hsla('+(key*2)+',50%,50%,0.9)',
                backgroundColor: 'hsla('+(key*2)+',50%,50%,0.9)',
                borderWidth: 1
            };
            datasets.push(dataset);
            if(labels.length == 0) {
                labels = entry.map(n => months[+n.month - 1]);
            }
        });

        let dataObj = {
            labels: labels,
            datasets: datasets
        }

        let chartObj = {
            type: "radar",
            data: dataObj,
            options: {
                scale: {
                    ticks: {
                        beginAtZero: true,
                        stepSize: 1
                    }
                },
                elements: {
                    line: {
                        fill: false
                    }
                },
                legend: {
                    labels: {
                        boxWidth: 20,
                        filter: function(item, chart) {
                            return new Number(item.text) % 20 == 0 || item.text % 2016 == 0;
                        }
                    }
                }
            }
        };
        new Chart("my-radar-chart", chartObj);
    }
</script>


</body>
</html>