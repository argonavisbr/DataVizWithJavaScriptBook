<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="../JavaScript/d3.layout.cloud.js"></script>
    <style>
        form {
            width: 100%;
            text-align: center;
        }
        button {
            font-family: impact;
            color: white;
            background: black;
            font-size: 24pt;
        }
    </style>
</head>
<body>
<div width="960" height="500" id="cloud"></div>
<form>
    <button type="button" id="next">Next</button>
</form>
<script>

    const colorScale = d3.scaleOrdinal(d3.schemeCategory10);
    const width = 960, height = 500;

    let data = [];
    let stats = [];
    const fontScale = d3.scaleLog().range([12, 100]);
    const BOOKS = 10;
    let book = 0;

    const cloudLayout = d3.layout.cloud()
            .spiral('archimedean')
            .size([width, height])
            .font('impact')
            .fontSize(function(d) {
                return fontScale(d.count);
            })
            .text(function(d) {
                return d.word;
            });

    const wordCloud = d3.select("#cloud").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + [width /2, height /2] + ")");

    d3.select("#next").on("click", function() {
        book = (book < BOOKS-1) ? ++book : 0;
        stats = data[book].stats;
        wordCloud.selectAll('*').remove();
        draw(stats);
    });

    d3.json("../Data/bookstats.json").then(function(d) {
        data = d;
        stats = data[book].stats;
        draw(stats);
    });

    function draw(data) {
        fontScale.domain([stats[stats.length-1].count, stats[0].count]);
        cloudLayout.words(stats).start();
        wordCloud.selectAll("text")
            .data(data, function(d) {
                return d.text;
            }).enter().append("text")
            .attr("text-anchor", "middle")
            .attr("transform", function(d) {
                return "translate(" + [d.x, d.y] + ") rotate(" + d.rotate + ")";
            })
            .style("font-size", function(d) {
                return d.size + "px";
            })
            .style("font-family", function(d) {
                return d.font;
            })
            .style("fill", function(d, i) {
                return colorScale(i);
            })
            .text(function(d) {
                return d.text;
            });
    }

</script>
</body>
</html>